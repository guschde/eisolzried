function isBetween(e,t,n,a){return-1==e.compareDateOnlyTz(n,a)&&1==t.compareDateOnlyTz(n,a)||0==e.compareDateOnlyTz(n,a)||0==t.compareDateOnlyTz(n,a)}function hasEventInDate(e,t,n){return e.isRecurring()?0==e.iterator(t).next().compare(t):isBetween(e.startDate,e.endDate,t,n)}function createEventDetails(e){var t="<p>";t+="Treffpunkt: ",t+=e.location,t+="<br />",t+="Beginn: ",t+=e.startDate.toJSDate().toTimeString().substring(0,5),t+="<br />",t+="Ende: ",t+=e.endDate.toJSDate().toTimeString().substring(0,5),t+="</p>",t+="<p>",t+=e.description,t+="</p>";var n=e.attachments;for(var a in n)t+='<a href="',t+=n[a].getFirstValue(),t+='">Zusatzinfo</a>';return t}function buildCal(e){function t(){var e=ICAL.Time.fromData({day:1,month:c.month(),year:c.year()});e.adjust(-6,0,0,0);for(var t=ICAL.Time.fromData({day:6,month:c.month()+1,year:c.year()}),n=[],a=0;a<d.length;a++){var r=new ICAL.Event(d[a]);r.isRecurring()?n.push(r):isBetween(e,t,r.startDate,l)&&isBetween(e,t,r.endDate,l)&&n.push(r)}return n}function n(e){var t='<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Schließen"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+e.summary+'</h4></div><div class="modal-body"><p>'+createEventDetails(e)+"</p></div>";m.setContent(t),m.show()}var a,r=ICAL.parse(e),o=new ICAL.Component(r),d=o.getAllSubcomponents("vevent"),i=o.getFirstSubcomponent("vtimezone"),s=i.getFirstPropertyValue("tzid"),l=new ICAL.Timezone({component:i,tzid:s}),c=drcal({weekdays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],startDay:1}),m=new Modal(document.getElementById("event-modal")),u=document.createElement("div");u.className="daynum";var g=document.createElement("a");g.className="dayevent",g.setAttribute("data-toggle","modal"),g.href="#event-modal";var h=[];c.addEventListener("drcal.renderDay",function(e){(a=u.cloneNode()).appendChild(document.createTextNode(e.detail.date.getDate())),e.detail.element.appendChild(a);for(var t=ICAL.Time.fromJSDate(e.detail.date),r=0;r<h.length;r++)if(hasEventInDate(h[r],t,l)&&((a=g.cloneNode()).setAttribute("title",h[r].summary),a.appendChild(document.createTextNode(h[r].summary)),e.detail.element.appendChild(a),e.detail.date.toDateString()==(new Date).toDateString())){var o={message:"Heute ist was los!",timeout:5e3,actionHandler:function(){n(h[r])},actionText:"Zeigen"};snackbar.showSnackbar(o)}}),c.addEventListener("drcal.monthChange",function(){h=t()}),c.changeMonth(new Date),c.addEventListener("click",function(e){if("dayevent"==e.target.className)for(var t=ICAL.Time.fromDateString(e.target.parentNode.getAttribute("date")),a=0;a<h.length;a++)if(hasEventInDate(h[a],t,l)&&e.target.innerHTML==h[a].summary){n(h[a]);break}});for(var v=c.querySelectorAll("button"),p=0;p<v.length;p++)v[p].classList.add("btn");document.getElementById("drcal").appendChild(c)}function addMessage(e){var t=document.createElement("li");t.textContent=e,document.getElementById("messages").append(t);var n=document.getElementById("chat-box");n.scrollTop=n.scrollHeight}function sendMessage(e){var t=document.getElementById("chat-input"),n=t.value;addMessage(n),t.value="",e.send(n)}fetch("/assets/data/termine.ics").then(function(e){return e.text()}).then(function(e){buildCal(e)});var ws=new WebSocket("wss://feuerwehr-eisolzried.de:62187");document.getElementById("chat-btn").onclick=function(){sendMessage(ws)},document.getElementById("chat-form").onkeypress=function(e){13==e.keyCode&&(sendMessage(ws),e.preventDefault())},ws.onmessage=function(e){addMessage(e.data)},document.getElementById("posts-btn").onclick=function(){for(var e=document.querySelectorAll(".hidden"),t=0;t<6;t++){if(e.length==t){this.classList.add("hidden");break}e[t].classList.remove("hidden")}};