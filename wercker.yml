box: phusion/passenger-ruby22
build:
  steps:
    # Install dependencies defined in Gemfile
    - bundle-install

    # Execute jekyll doctor to validate the
    # site against a list of known issues/deprecates.
    - script:
        name: jekyll doctor
        code: bundle exec jekyll doctor

    # Generate the jekyll site with trace information on.
    - script:
        name: jekyll build
        code: bundle exec jekyll build --trace
deploy:
  steps:
    - install-packages:
        packages: git
    - lukevivier/gh-pages@0.2.1:
        token: $GIT_TOKEN
        domain: feuerwehr-eisolzried.de
        basedir: _site
    - install-packages:
        packages: lftp
    - script:
        name: prepare lftp settings
        code: |
          mkdir -p $HOME/.lftp
          echo "set ssl:verify-certificate no" > $HOME/.lftp/rc
    - script:
        name: sync with remote
        code: lftp -e "set ftp:ssl-allow no;mirror -R _site/ webseiten/" -u $FTP_USERNAME,$FTP_PASSWORD $FTP_URL
