var n=5,m=10,margin={top:20,right:50,bottom:50,left:20},width=640-margin.left-margin.right,height=500-margin.top-margin.bottom,svg=d3.select("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("/data/stats.csv",function(t){function a(){clearTimeout(p),"grouped"===this.value?e():r()}function e(){c.domain([0,o]),m.transition().duration(500).delay(function(t,n){return 10*n}).attr("x",function(t,a,e){return l(t.x)+l.rangeBand()/n*e}).attr("width",l.rangeBand()/n).transition().attr("y",function(t){return c(t.y)}).attr("height",function(t){return height-c(t.y)}),svg.select(".axis--y").transition().duration(500).ease("sin-in-out").call(h)}function r(){c.domain([0,d]),m.transition().duration(500).delay(function(t,n){return 10*n}).attr("y",function(t){return c(t.y0+t.y)}).attr("height",function(t){return c(t.y0)-c(t.y0+t.y)}).transition().attr("x",function(t){return l(t.x)}).attr("width",l.rangeBand()),svg.select(".axis--y").transition().duration(500).ease("sin-in-out").call(h)}var i=["Aktive","Jugend","Ehrenmitglieder","Passive","Ausgetreten"],s=d3.layout.stack()(i.map(function(n){return t.map(function(t){return{x:t.Jahr,y:+t[n]}})})),o=d3.max(s,function(t){return d3.max(t,function(t){return t.y})}),d=d3.max(s,function(t){return d3.max(t,function(t){return t.y0+t.y})}),l=d3.scale.ordinal().domain(s[0].map(function(t){return t.x})).rangeRoundBands([25,width],.08),c=d3.scale.linear().domain([0,d]).range([height,0]),u=d3.scale.ordinal().range(["#98ABC5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c"]),g=d3.svg.axis().scale(l).tickSize(10).tickPadding(6).orient("bottom"),h=d3.svg.axis().scale(c).orient("left").tickFormat(d3.format(".2s")),f=svg.selectAll(".layer").data(s).enter().append("g").attr("class","layer").style("fill",function(t,n){return u(n)}),m=f.selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return l(t.x)}).attr("y",height).attr("width",l.rangeBand()).attr("height",0);m.transition().delay(function(t,n){return 10*n}).attr("y",function(t){return c(t.y0+t.y)}).attr("height",function(t){return c(t.y0)-c(t.y0+t.y)}),svg.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+height+")").call(g),svg.append("g").attr("class","axis axis--y").attr("transform","translate(20,0)").call(h).append("text").attr("x",2).attr("y",c(c.ticks(10).pop())).attr("dy","0.35em").style("text-anchor","start").text("Anzahl");var y=svg.selectAll(".legend").data(u.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(t,n){return"translate(-320,"+20*n+")"}).style("font","10px sans-serif");y.append("rect").attr("x",width-18).attr("width",18).attr("height",18).style("fill",u),y.selectAll("text .legend").data([i.slice().reverse()]).enter().append("text").attr("x",width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t,n,a){return t[a]}),d3.selectAll("input").on("change",a);var p=setTimeout(function(){d3.select('input[value="grouped"]').property("checked",!0).each(a)},2e3)});