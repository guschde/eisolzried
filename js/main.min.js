function hasEventInDate(a,b,c){if(a.isRecurring()){var d=a.iterator(b);if(0==d.next().compare(b))return!0}else if(a.startDate.compareDateOnlyTz(b,c)==-1&&1==a.endDate.compareDateOnlyTz(b,c)||0==a.startDate.compareDateOnlyTz(b,c)||0==a.endDate.compareDateOnlyTz(b,c))return!0;return!1}function createEventDetails(a){var b="<p>";b+="Treffpunkt: ",b+=a.location,b+="<br />",b+="Beginn: ",b+=a.startDate.toJSDate().toTimeString().substring(0,5),b+="<br />",b+="Ende: ",b+=a.endDate.toJSDate().toTimeString().substring(0,5),b+="</p>",b+="<p>",b+=a.description,b+="</p>";var c=a.attachments;for(var d in c)b+='<a href="',b+=c[d].getFirstValue(),b+='">Zusatzinfo</a>';return b}function buildCal(a){for(var b=ICAL.parse(a),c=new ICAL.Component(b),d=c.getAllSubcomponents("vevent"),e=[],f=0;f<d.length;f++)e[f]=new ICAL.Event(d[f]);var g=e.length,h=c.getFirstSubcomponent("vtimezone"),i=h.getFirstPropertyValue("tzid"),j=new ICAL.Timezone({component:h,tzid:i}),k=drcal({weekdays:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],months:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],startDay:1});k.addEventListener("drcal.renderDay",function(a){var b=document.createElement("div");b.className="daynum",b.appendChild(document.createTextNode(a.detail.date.getDate())),a.detail.element.appendChild(b);for(var c=ICAL.Time.fromJSDate(a.detail.date),d=0;d<g;d++)if(hasEventInDate(e[d],c,j)){var f=document.createElement("div");f.className="dayevent",f.setAttribute("data-toggle","modal"),f.setAttribute("data-target",".bs-example-modal-sm"),f.appendChild(document.createTextNode(e[d].summary)),a.detail.element.appendChild(f)}}),k.changeMonth(new Date),k.addEventListener("click",function(a){if("DIV"==a.target.tagName)for(var b=ICAL.Time.fromDateString(a.target.parentNode.getAttribute("date")),c=0;c<g;c++)if(hasEventInDate(e[c],b,j)&&a.target.innerHTML==e[c].summary){$(".modal-body").html(createEventDetails(e[c])),$(".modal-title").html(e[c].summary);break}});for(var l=k.querySelectorAll("button"),f=0;f<l.length;f++)l[f].classList.add("btn");document.getElementById("drcal").appendChild(k)}longlist(document.getElementById("posts"),{perPage:5}),$.get("/data/termine.ics").then(buildCal);var socket=io.connect("https://feuerwehr-eisolzried.de:62187");$("#chatinput").submit(function(){return socket.emit("chat message",$("#m").val()),$("#m").val(""),!1}),socket.on("chat message",function(a){$("#messages").append($("<li>").text(a)),$(".chatbox").scrollTop($(".chatbox")[0].scrollHeight)});