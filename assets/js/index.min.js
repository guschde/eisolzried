"use strict";function isBetween(e,t,a,n){return-1==e.compareDateOnlyTz(a,n)&&1==t.compareDateOnlyTz(a,n)||0==e.compareDateOnlyTz(a,n)||0==t.compareDateOnlyTz(a,n)}function hasEventInDate(e,t,a){return e.isRecurring()?0==e.iterator(t).next().compare(t):isBetween(e.startDate,e.endDate,t,a)}function createEventDetails(e){var t="<p>";t+="Treffpunkt: ",t+=e.location,t+="<br />",t+="Beginn: ",t+=e.startDate.toJSDate().toTimeString().substring(0,5),t+="<br />",t+="Ende: ",t+=e.endDate.toJSDate().toTimeString().substring(0,5),t+="</p>",t+="<p>",t+=e.description,t+="</p>";var a=e.attachments;for(var n in a)t+='<a href="',t+=a[n].getFirstValue(),t+='">Zusatzinfo</a>';return t}function buildCal(e){function t(){var e=ICAL.Time.fromData({day:1,month:l.month(),year:l.year()});e.adjust(-6,0,0,0);for(var t=ICAL.Time.fromData({day:6,month:l.month()+1,year:l.year()}),a=[],n=0;n<s.length;n++){var r=new ICAL.Event(s[n]);r.isRecurring()?a.push(r):isBetween(e,t,r.startDate,i)&&isBetween(e,t,r.endDate,i)&&a.push(r)}return a}var a,n=ICAL.parse(e),r=new ICAL.Component(n),s=r.getAllSubcomponents("vevent"),o=r.getFirstSubcomponent("vtimezone"),d=o.getFirstPropertyValue("tzid"),i=new ICAL.Timezone({component:o,tzid:d}),l=drcal({weekdays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],startDay:1}),c=document.createElement("div");c.className="daynum";var m=document.createElement("a");m.className="dayevent",m.setAttribute("data-toggle","modal"),m.href="#event-modal";var u=[];l.addEventListener("drcal.renderDay",function(e){(a=c.cloneNode()).appendChild(document.createTextNode(e.detail.date.getDate())),e.detail.element.appendChild(a);for(var t=ICAL.Time.fromJSDate(e.detail.date),n=0;n<u.length;n++)if(hasEventInDate(u[n],t,i)&&((a=m.cloneNode()).setAttribute("title",u[n].summary),a.appendChild(document.createTextNode(u[n].summary)),e.detail.element.appendChild(a),e.detail.date.toDateString()==(new Date).toDateString())){var r=document.getElementById("snackbar");r.classList.add("snackbar--active"),setTimeout(function(){r.classList.remove("snackbar--active")},5e3)}}),l.addEventListener("drcal.monthChange",function(){u=t()}),l.changeMonth(new Date);var v=new Modal(document.getElementById("event-modal"));l.addEventListener("click",function(e){if("dayevent"==e.target.className)for(var t=ICAL.Time.fromDateString(e.target.parentNode.getAttribute("date")),a=0;a<u.length;a++)if(hasEventInDate(u[a],t,i)&&e.target.innerHTML==u[a].summary){var n='<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Schließen"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+u[a].summary+'</h4></div><div class="modal-body"><p>'+createEventDetails(u[a])+"</p></div>";v.setContent(n),v.show();break}});for(var g=l.querySelectorAll("button"),h=0;h<g.length;h++)g[h].classList.add("btn");document.getElementById("drcal").appendChild(l)}function addMessage(e){var t=document.createElement("li");t.textContent=e,document.getElementById("messages").append(t);var a=document.getElementById("chat-box");a.scrollTop=a.scrollHeight}function sendMessage(e){var t=document.getElementById("chat-input"),a=t.value;addMessage(a),t.value="",e.send(a)}fetch("/assets/data/termine.ics").then(function(e){return e.text()}).then(function(e){buildCal(e)});var ws=new WebSocket("wss://feuerwehr-eisolzried.de:62187");document.getElementById("chat-btn").onclick=function(){sendMessage(ws)},document.getElementById("chat-form").onkeypress=function(e){13==e.keyCode&&(sendMessage(ws),e.preventDefault())},ws.onmessage=function(e){addMessage(e.data)},document.getElementById("posts-btn").onclick=function(){for(var e=document.querySelectorAll(".hidden"),t=0;t<8;t++){if(e.length==t){this.classList.add("hidden");break}e[t].classList.remove("hidden")}};