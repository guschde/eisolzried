function isBetween(e,t,n,a){return-1==e.compareDateOnlyTz(n,a)&&1==t.compareDateOnlyTz(n,a)||0==e.compareDateOnlyTz(n,a)||0==t.compareDateOnlyTz(n,a)}function hasEventInDate(e,t,n){return e.isRecurring()?0==e.iterator(t).next().compare(t):isBetween(e.startDate,e.endDate,t,n)}function createEventDetails(e){var t="<p>";t+="Treffpunkt: ",t+=e.location,t+="<br />",t+="Beginn: ",t+=e.startDate.toJSDate().toTimeString().substring(0,5),t+="<br />",t+="Ende: ",t+=e.endDate.toJSDate().toTimeString().substring(0,5),t+="</p>",t+="<p>",t+=e.description,t+="</p>";var n=e.attachments;for(var a in n)t+='<a href="',t+=n[a].getFirstValue(),t+='">Zusatzinfo</a>';return t}function buildCal(e){function t(){var e=ICAL.Time.fromData({day:1,month:l.month(),year:l.year()});e.adjust(-6,0,0,0);for(var t=ICAL.Time.fromData({day:6,month:l.month()+1,year:l.year()}),n=[],a=0;a<o.length;a++){var r=new ICAL.Event(o[a]);r.isRecurring()?n.push(r):isBetween(e,t,r.startDate,i)&&isBetween(e,t,r.endDate,i)&&n.push(r)}return n}var n,a=ICAL.parse(e),r=new ICAL.Component(a),o=r.getAllSubcomponents("vevent"),d=r.getFirstSubcomponent("vtimezone"),s=d.getFirstPropertyValue("tzid"),i=new ICAL.Timezone({component:d,tzid:s}),l=drcal({weekdays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],startDay:1}),c=document.createElement("div");c.className="daynum";var m=document.createElement("a");m.className="dayevent",m.setAttribute("data-toggle","modal"),m.href="#event-modal";var u=[];l.addEventListener("drcal.renderDay",function(e){(n=c.cloneNode()).appendChild(document.createTextNode(e.detail.date.getDate())),e.detail.element.appendChild(n);for(var t=ICAL.Time.fromJSDate(e.detail.date),a=0;a<u.length;a++)hasEventInDate(u[a],t,i)&&((n=m.cloneNode()).setAttribute("title",u[a].summary),n.appendChild(document.createTextNode(u[a].summary)),e.detail.element.appendChild(n))}),l.addEventListener("drcal.monthChange",function(){u=t()}),l.changeMonth(new Date);var h=new Modal(document.getElementById("event-modal"));l.addEventListener("click",function(e){if("dayevent"==e.target.className)for(var t=ICAL.Time.fromDateString(e.target.parentNode.getAttribute("date")),n=0;n<u.length;n++)if(hasEventInDate(u[n],t,i)&&e.target.innerHTML==u[n].summary){var a='<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Schließen"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+u[n].summary+'</h4></div><div class="modal-body"><p>'+createEventDetails(u[n])+"</p></div>";h.setContent(a),h.show();break}});for(var v=l.querySelectorAll("button"),g=0;g<v.length;g++)v[g].classList.add("btn");document.getElementById("drcal").appendChild(l)}function addMessage(e){var t=document.createElement("li");t.textContent=e,document.getElementById("messages").append(t);var n=document.getElementById("chat-box");n.scrollTop=n.scrollHeight}function sendMessage(e){var t=document.getElementById("chat-input"),n=t.value;addMessage(n),t.value="",e.send(n)}fetch("/assets/data/termine.ics").then(function(e){return e.text()}).then(function(e){buildCal(e)});var ws=new WebSocket("wss://feuerwehr-eisolzried.de:62187");document.getElementById("chat-btn").onclick=function(){sendMessage(ws)},document.getElementById("chat-form").onkeypress=function(e){13==e.keyCode&&(sendMessage(ws),e.preventDefault())},ws.onmessage=function(e){addMessage(e.data)},document.getElementById("posts-btn").onclick=function(){for(var e=document.querySelectorAll(".hidden"),t=0;t<8;t++){if(e.length==t){this.classList.add("hidden");break}e[t].classList.remove("hidden")}};